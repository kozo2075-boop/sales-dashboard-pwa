<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Sales Dashboard</title>

    <!-- できるだけ速く DNS/SSL を張る（体感が少し良くなる） -->
    <link rel="dns-prefetch" href="//sales-dashboard-myfans-candfans.streamlit.app" />
    <link rel="preconnect" href="https://sales-dashboard-myfans-candfans.streamlit.app" crossorigin />

    <!-- キャッシュ抑制（更新反映用） -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <style>
      :root {
        --bg: #0b1020;
        --fg: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.65);
        --bar-bg: rgba(255, 255, 255, 0.12);
        --bar-glow: #b6ff2e; /* 蛍光黄緑 */
        --card: rgba(255, 255, 255, 0.06);
        --card-border: rgba(255, 255, 255, 0.10);
      }
      html, body {
        height: 100%;
        margin: 0;
        background: var(--bg);
        color: var(--fg);
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
      }
      .wrap {
        height: 100%;
        display: grid;
        place-items: center;
        padding: 24px;
      }
      .card {
        width: min(520px, 92vw);
        padding: 28px 22px 24px;
        border-radius: 18px;
        background: var(--card);
        border: 1px solid var(--card-border);
        box-shadow: 0 12px 40px rgba(0,0,0,0.35);
        text-align: center;
      }
      .icon {
        width: 104px;
        height: 104px;
        border-radius: 22px;
        display: block;
        margin: 6px auto 18px;
        image-rendering: auto;
        filter: drop-shadow(0 10px 20px rgba(0,0,0,0.35));
      }
      .title {
        font-weight: 800;
        letter-spacing: 0.2px;
        margin: 0 0 8px;
        font-size: 18px;
      }
      .subtitle {
        margin: 0 0 18px;
        color: var(--muted);
        font-size: 13px;
        line-height: 1.6;
      }
      .bar {
        width: 100%;
        height: 12px;
        background: var(--bar-bg);
        border-radius: 999px;
        overflow: hidden;
        position: relative;
        border: 1px solid rgba(255,255,255,0.10);
      }
      .bar > .fill {
        height: 100%;
        width: 0%;
        background: var(--bar-glow);
        border-radius: 999px;
        box-shadow: 0 0 18px rgba(182, 255, 46, 0.55);
        transition: width 120ms linear;
      }
      .pct {
        margin-top: 10px;
        font-variant-numeric: tabular-nums;
        font-weight: 700;
        letter-spacing: 0.5px;
        color: rgba(255,255,255,0.82);
        font-size: 14px;
      }
      .hint {
        margin-top: 10px;
        font-size: 12px;
        color: rgba(255,255,255,0.55);
      }

      @media (prefers-reduced-motion: reduce) {
        .bar > .fill { transition: none; }
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <div class="card" role="status" aria-live="polite">
        <img class="icon" src="/icon-512x512.png" alt="App Icon" />
        <p class="title">Sales Dashboard</p>
        <p class="subtitle">ダッシュボードへ接続中…</p>

        <div class="bar" aria-label="loading">
          <div class="fill" id="fill"></div>
        </div>
        <div class="pct" id="pct">0%</div>
        <div class="hint">※進捗は目安です</div>
      </div>
    </div>

    <script>
      (function () {
        // ===== 設定 =====
        const STREAMLIT_URL = "https://sales-dashboard-myfans-candfans.streamlit.app/";
        const MIN_SHOW_MS = 250;      // スプラッシュが一瞬で消えないよう最低表示
        const MAX_WAIT_MS = 9000;     // 長引いたら強制遷移
        const TARGET_HOLD = 99;       // 遷移直前は 99% で待機
        const RAMP_TO = 95;           // 通常は 95% まで滑らかに増やす
        const RAMP_MS = 2200;         // 0→95% までの目標時間（体感調整用）
        const TICK_MS = 60;

        const fill = document.getElementById("fill");
        const pctEl = document.getElementById("pct");

        // Pages側のクエリ/ハッシュを引き継ぐ（?v= など）
        const qs = window.location.search || "";
        const hash = window.location.hash || "";

        let start = performance.now();
        let lastPct = 0;
        let forced = false;

        function setPct(p) {
          const v = Math.max(0, Math.min(100, Math.round(p)));
          if (v === lastPct) return;
          lastPct = v;
          fill.style.width = v + "%";
          pctEl.textContent = v + "%";
        }

        // 擬似進捗：最初は早く、その後ゆっくり（よくあるUX）
        function computeRampPct(elapsedMs) {
          const t = Math.max(0, Math.min(1, elapsedMs / RAMP_MS));
          // easeOutCubic
          const eased = 1 - Math.pow(1 - t, 3);
          return eased * RAMP_TO;
        }

        // 遷移（最後に 100% にしてから移動）
        function go() {
          if (forced) return;
          forced = true;
          setPct(100);

          // 100% が描画される余地をちょい入れる
          setTimeout(function () {
            window.location.replace(STREAMLIT_URL + qs + hash);
          }, 120);
        }

        // メインループ
        const timer = setInterval(function () {
          const now = performance.now();
          const elapsed = now - start;

          // 0→95% まで
          let p = computeRampPct(elapsed);

          // 最低表示時間を過ぎたら “遷移準備” に入る
          if (elapsed >= MIN_SHOW_MS) {
            // 95% を超えたら 99% までゆっくり寄せる
            if (p >= RAMP_TO) {
              const extra = Math.min(1, (elapsed - RAMP_MS) / 2500);
              p = RAMP_TO + extra * (TARGET_HOLD - RAMP_TO);
            }

            // MAX_WAIT を超えたら強制遷移
            if (elapsed >= MAX_WAIT_MS) {
              clearInterval(timer);
              go();
              return;
            }
          }

          setPct(p);
        }, TICK_MS);

        // だいたい 3〜5秒で自然に遷移する想定（必要なら調整）
        // 遷移タイミングは「最低表示 + ほどよい待ち」のバランス
        const nominalGoMs = Math.max(MIN_SHOW_MS + 650, 1400);
        setTimeout(function () {
          clearInterval(timer);
          // 遷移直前：99%まで寄せてから 100% にして飛ぶ
          setPct(TARGET_HOLD);
          go();
        }, nominalGoMs);
      })();
    </script>

    <noscript>
      <meta http-equiv="refresh" content="0;url=https://sales-dashboard-myfans-candfans.streamlit.app/" />
    </noscript>
  </body>
</html>
